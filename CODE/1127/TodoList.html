<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo List</title>
  </head>
  <body>
    <h1>Todo List</h1>

    <!-- 입력폼: Enter / 버튼으로 모두 추가 처리 -->
    <form id="todoForm">
      <input
        id="todoInput"
        type="text"
        placeholder="할 일을 입력하세요"
        autocomplete="off"
      />
      <button type="submit" id="addBtn">추가</button>
    </form>

    <!-- 필터 버튼 영역 -->
    <div>
      <button id="filterAll">전체</button>
      <button id="filterActive">미완료</button>
      <button id="filterCompleted">완료</button>
      <!-- 완료된 항목 일괄 삭제 버튼 -->
      <button id="clearCompletedBtn">완료된 항목 삭제</button>
    </div>

    <!-- 남은 할 일 개수 표시 -->
    <p id="todoCount">남은 할 일: 0개</p>

    <!-- 할 일 목록이 렌더링될 영역 -->
    <ul id="todoList"></ul>

    <script>
      // 요소 선택
      const todoForm = document.querySelector("#todoForm");
      const todoInput = document.querySelector("#todoInput");
      const todoList = document.querySelector("#todoList");
      const todoCount = document.querySelector("#todoCount");

      const filterAllBtn = document.querySelector("#filterAll");
      const filterActiveBtn = document.querySelector("#filterActive");
      const filterCompletedBtn = document.querySelector("#filterCompleted");
      const clearCompletedBtn = document.querySelector("#clearCompletedBtn");

      // 상태 관리용 데이터 (할 일 목록 + 현재 필터)
      let todos = [];
      let currentFilter = "all";

      // 할 일 추가 함수
      function addTodo() {
        const todoText = todoInput.value.trim();
        if (todoText === "") {
          alert("할 일을 입력하세요!");
          return;
        }

        const todo = {
          id: Date.now(),
          text: todoText,
          completed: false,
        };

        todos.push(todo);
        renderTodos();

        todoInput.value = "";
        todoInput.focus();
      }

      // 완료 / 미완료 토글 함수
      function toggleTodo(id) {
        todos = todos.map((todo) =>
          todo.id === id ? { ...todo, completed: !todo.completed } : todo
        );
        renderTodos();
      }

      // 개별 할 일 삭제 함수
      function deleteTodo(id) {
        todos = todos.filter((todo) => todo.id !== id);
        renderTodos();
      }

      // 필터 상태 변경 함수
      function filterTodos(filter) {
        currentFilter = filter;
        renderTodos();
      }

      // 완료된 항목 일괄 삭제 함수
      function clearCompleted() {
        todos = todos.filter((todo) => !todo.completed);
        renderTodos();
      }

      // 화면에 목록과 스타일을 다시 그리는 함수
      function renderTodos() {
        todoList.textContent = "";

        let filteredTodos = [];
        if (currentFilter === "all") {
          filteredTodos = todos;
        } else if (currentFilter === "active") {
          filteredTodos = todos.filter((todo) => !todo.completed);
        } else {
          filteredTodos = todos.filter((todo) => todo.completed);
        }

        filteredTodos.forEach((todo) => {
          const li = document.createElement("li");

          const span = document.createElement("span");
          span.textContent = todo.text;
          if (todo.completed) {
            span.style.textDecoration = "line-through";
          }
          span.addEventListener("click", () => toggleTodo(todo.id));

          const deleteBtn = document.createElement("button");
          deleteBtn.textContent = "삭제";
          deleteBtn.addEventListener("click", () => deleteTodo(todo.id));

          li.append(span, deleteBtn);
          todoList.appendChild(li);
        });

        updateCount();
      }

      // 남은 할 일 개수 텍스트를 갱신하는 함수
      function updateCount() {
        const remain = todos.filter((todo) => !todo.completed).length;
        todoCount.textContent = `남은 할 일: ${remain}개`;
      }

      // 이벤트 등록: 폼 제출(Enter/버튼) + 필터 버튼 + 일괄 삭제
      todoForm.addEventListener("submit", (event) => {
        event.preventDefault(); // 기본 동작(페이지 새로고침) 방지
        addTodo();
      });
      filterAllBtn.addEventListener("click", () => filterTodos("all"));
      filterActiveBtn.addEventListener("click", () => filterTodos("active"));
      filterCompletedBtn.addEventListener("click", () =>
        filterTodos("completed")
      );
      clearCompletedBtn.addEventListener("click", clearCompleted);
    </script>
  </body>
</html>
